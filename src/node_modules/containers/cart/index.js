import React from 'react'
import {connect} from 'react-redux'
import R from 'ramda'
import {Link} from 'react-router'

import {
    getTotalCartPrice,
    getCartWatchesWithCount
} from 'selectors'

import {
    removeWatchFromCart,
    cartCheckOut,
    cleanCart
} from 'actions'

const Cart = ({
    watches, 
    totalPrice, 
    removeWatchFromCart, 
    cartCheckOut, 
    cleanCart
}) => {

    const isBasketEmpty = R.isEmpty(watches)

    const renderContent = () => (
        <div>
            {isBasketEmpty && <div> Your shopping Cart is is Empty </div>}

            <div className='table-responsive'>
                <table className='table-bordered table-striped table-condensed cf'>
                    <tbody>
                        {watches.map((watch,index)=>(
                            <tr
                                key={index}
                                className='item-checout'
                            >
                                <td 
                                    className='first-column-checkout'
                                >
                                    <img
                                        className='img-thumbnail'
                                        src={watch.image}
                                        alt={watch.name}
                                        />
                                </td>
                                <td>{watch.name}</td>
                                <td>${watch.price}</td>
                                <td>{watch.count}</td>
                                <td>
                                    <span
                                        onClick={()=> removeWatchFromCart(watch.id)} 
                                        className='delete-cart'
                                    >
                                    </span>
                                </td> 
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
            {
                R.not(isBasketEmpty) && 
                    <div className='row'>
                        <div className='pull-right total-user-checkout'>
                            <b>Total:</b>
                            ${totalPrice}
                        </div>
                    </div>
            }
        </div>
    )
        
    const renderSidebar = () => (
        <div>
            <Link
                to='/'
                className='btn btn-info'
            >
                <span className='glyphicon glypphicon-ingo-sign' />
                <span> Continue shopping </span>
            </Link>
            {
                R.not(isBasketEmpty) && 
                <div>
                    <button
                        onClick={cleanCart}
                        className='btn btn-danger'
                    >
                        <span className='glyphicon glyphicon-trash'>Clear cart</span>
                    </button>
                    <button
                        onClick={()=> cartCheckOut(watches)}
                        className='btn btn-success'
                    >
                        <span className='glyphicon glyphicon-envelope'>Checkout</span>
                    </button>
                </div>
            }
        </div>
    )
        
    
    return (
        <div className='container top-margin'>
            <div className='row'>
                <div className='col-md-9'>
                    {renderContent()}
                </div>
                <div className='col-md-3 btn-user-checkout'>
                    {renderSidebar()}
                </div>
            </div>
        </div>
    )
}

const mapStateToProps = state => ({
    watches:getCartWatchesWithCount(state),
    totalPrice:getTotalCartPrice(state)
})

const mapDispatchToProps = ({
    removeWatchFromCart,
    cartCheckOut,
    cleanCart
})

export default connect(mapStateToProps,mapDispatchToProps)(Cart)